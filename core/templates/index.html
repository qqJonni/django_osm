{% extends 'base.html' %}
{% load static %}

{% block content %}

    <div id="map" style="height: 700px; width: 100%;"></div>

    <script>
        // Получаем данные точек из шаблона и парсим их
        let stationsData = {{ places_posts|safe }};

        // Создаем иконку
        var greenIcon = L.icon({
            iconUrl: 'static/leaf-green.png',
            shadowUrl: 'static/leaf-shadow.png',
            iconSize:     [38, 95],
            shadowSize:   [50, 64],
            iconAnchor:   [22, 94],
            shadowAnchor: [4, 62],
            popupAnchor:  [-3, -76]
        });

        // Инициализируем карту
        var map = L.map('map').setView([41.6941, 44.8337], 8);
        L.tileLayer('https://tile.openstreetmap.org/{z}/{x}/{y}.png', {
            maxZoom: 19,
            attribution: '&copy; <a href="http://www.openstreetmap.org/copyright">OpenStreetMap</a>'
        }).addTo(map);

        // Добавляем маркеры для каждой точки
        stationsData.features.forEach(feature => {
            // Создаем маркер
            var marker = L.marker(feature.geometry.coordinates.reverse(), {icon: greenIcon}).addTo(map);

            // Добавляем всплывающее окно (popup) с названием локации
            marker.bindPopup(`
            <strong>${feature.properties.title}</strong><br>
            ${feature.properties.description_short}<br>
            ${feature.properties.description_long}
            ${feature.properties.image_urls}

        `);

        });
    </script>


{% endblock %}
